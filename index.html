<script>
        // --- PAGE TRANSITION & BACK BUTTON FIX ---
        const curtain = document.querySelector('.page-transition');

        // FORCE Reveal Function
        function forceReveal() {
            // We use a tiny timeout to ensure the browser rendering catches up
            requestAnimationFrame(() => {
                curtain.classList.add('reveal');
            });
        }

        // 1. Initial Load
        window.addEventListener('load', () => {
            setTimeout(forceReveal, 100);
        });

        // 2. Browser Back Button (The "Nuclear" Fix)
        // This runs EVERY time the page becomes visible.
        // We removed the "if (event.persisted)" check to force it to run always.
        window.addEventListener('pageshow', () => {
            forceReveal();
        });

        // 3. Link Handling
        document.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function(e) {
                // Ignore external links
                if(this.target === '_blank') return;
                // Ignore clicks to the current page
                if(this.href === window.location.href) return;

                e.preventDefault();
                curtain.classList.remove('reveal'); // Drop Curtain
                
                const href = this.getAttribute('href');
                setTimeout(() => window.location.href = href, 800);
            });
        });

        // --- MOUSE & MORPH LOGIC ---
        (function() {
            const follower = document.querySelector('.cursor-follower');
            const revealContainer = document.getElementById('reveal-container');
            const items = document.querySelectorAll('.project-item');
            
            let mouseX = window.innerWidth / 2, mouseY = window.innerHeight / 2;
            let followerX = mouseX, followerY = mouseY;
            let currentImgUrl = null; 

            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });

            function animateCursor() {
                followerX += (mouseX - followerX) * 0.1; 
                followerY += (mouseY - followerY) * 0.1;
                
                if(follower) follower.style.transform = `translate(${followerX}px, ${followerY}px) translate(-50%, -50%)`;
                if(revealContainer) {
                    revealContainer.style.left = `${followerX}px`;
                    revealContainer.style.top = `${followerY}px`;
                }
                requestAnimationFrame(animateCursor);
            }
            animateCursor();

            function switchImage(newUrl) {
                if (currentImgUrl === newUrl) return; 
                currentImgUrl = newUrl;

                const newImg = document.createElement('img');
                newImg.src = newUrl;
                newImg.classList.add('img-enter'); 
                
                if(revealContainer) {
                    revealContainer.appendChild(newImg);
                    const oldImages = revealContainer.querySelectorAll('img:not(.img-enter)');
                    oldImages.forEach(img => {
                        img.classList.remove('img-enter');
                        img.classList.add('img-exit'); 
                        setTimeout(() => { if(img.parentNode) img.parentNode.removeChild(img); }, 600);
                    });
                }
            }

            items.forEach(item => {
                item.addEventListener('mouseenter', () => {
                    follower.classList.add('active');
                    if(revealContainer) revealContainer.classList.add('visible');
                    const imgUrl = item.getAttribute('data-img');
                    if(imgUrl) switchImage(imgUrl);
                });

                item.addEventListener('mouseleave', () => {
                    follower.classList.remove('active');
                    if(revealContainer) revealContainer.classList.remove('visible');
                });
            });
        })();
    </script>
